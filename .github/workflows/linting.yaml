#
# SPDX-License-Identifier: MIT
#
# Copyright (C) 2025 Daniel Bourdrez. All Rights Reserved.
#
# This source code is licensed under the MIT license found in the
# LICENSE file in the root directory of this source tree or at
# https://spdx.org/licenses/MIT.html
#

name: Linting

on:
  workflow_call:
    inputs:
      golangci-config-path:
        required: false
        description: "Path to the golangci-lint configuration file"
        type: string
        default: ./.github/.golangci.yaml
      scope:
        required: false
        description: "Scope to lint"
        type: string
        default: ./...

permissions: {}

jobs:
  GoFMT:
    name: Check formatting
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Init go
        uses: bytemare/actions/init-go@435fe38d773c381b8e162ce13da2233c9080c960

      - name: Check formatting
        run: |
          if [[ -n "$(gofmt -l .)" ]]; then
            echo "The following files are not formatted correctly:"
            gofmt -l .
            exit 1
          fi

  DoNotSubmit:
    name: Do Not Submit
    permissions:
      contents: read
    uses: ./.github/workflows/do-not-submit.yaml

  GolangCILint:
    name: GolangCI Lint
    permissions:
      contents: read
    uses: ./.github/workflows/golangci-lint.yaml
    with:
      config-path: ${{inputs.golangci-config-path}}
      scope: ${{inputs.scope}}